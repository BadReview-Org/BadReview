@using System.Globalization

@if (Reviews.Any())
{
    <MudStack Spacing="2">
        @foreach (var review in Reviews.Take(5))
{
    <MudLink Href="@($"/game/{review.Game?.Id}")" Style="text-decoration: none; color: inherit;">
        <MudPaper Class="pa-3" Elevation="2" Style="background: rgba(255,255,255,0.05);">
            <MudStack Row="true" Spacing="2" Style="flex: 1;">
                <MudPaper Width="50px" Elevation="2" Style="height: 70px; background: rgba(255,255,255,0.05); padding: 0; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                    <img src="@ImageHelper.GetCoverUrl(review.Game?.CoverId)" 
                        alt="@review.Game?.Name"
                        style="max-width: 100%; max-height: 100%; object-fit: contain; transition: transform 0.3s ease;"
                        class="game-cover" />
                </MudPaper>
                <MudStack Spacing="1" Style="flex: 1;">
                    <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Style="width: 100%;">
                        <MudStack Row="true" Spacing="1">
                            <MudText Typo="Typo.subtitle1" Style="font-weight: 600;display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">
                                @(review.Game?.Name ?? "Unknown Game")
                            </MudText>
                            <MudChip T="string" Size="Size.Small" Color="Color.Info">
                                @review.StateEnum.ToString()
                            </MudChip>
                        </MudStack>
                        @if (review.Rating.HasValue)
                        {
                            <MudRating Disabled=true SelectedValue="@review.Rating.Value" ReadOnly="true" Size="Size.Small" />
                        }
                    </MudStack>
                    @if (!string.IsNullOrEmpty(review.ReviewText))
                    {
                        <MudText Typo="Typo.body2" Style="color: #b0b0b0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">
                            @review.ReviewText
                        </MudText>
                    }
                    <MudStack Row="true" Spacing="1">
                        <MudText Typo="Typo.caption" Style="color: #808080;">
                            @review.CreatedAt.ToString("MMM dd, yyyy", CultureInfo.InvariantCulture)
                        </MudText>
                    </MudStack>
                </MudStack>
            </MudStack>
        </MudPaper>
    </MudLink>
}
    </MudStack>
}

else if (BasicReviews.Any())
{
<MudPaper Class="pa-4" Elevation="6" Style="background: linear-gradient(145deg, #2a2a2a, #1a1a1a);">
    <MudText Typo="Typo.h5" Class="mb-3" Style="color: #667eea;">
    <MudIcon Icon="@Icons.Material.Filled.RateReview" Size="Size.Medium" Class="mr-2" />
        Reviews (@BasicReviews.Count)
    </MudText>
    <MudStack Spacing="2">
    @foreach (BasicReviewDto review in BasicReviews.Take(5))
    {
        <MudPaper Class="pa-3" Elevation="2" Style="background: rgba(255,255,255,0.05);">
            <MudStack Spacing="1">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <MudStack Row="true" Spacing="1">
                        <MudText Typo="Typo.subtitle1" Style="font-weight: 600;">
                        <MudLink Href="@($"/user/{review.User?.Id}")" Style="text-decoration: none; color: inherit;">
                            @(review.User?.Username ?? "Unknown User")
                        </MudLink>
                        </MudText>
                        <MudChip T="string" Size="Size.Small" Color="Color.Info">
                            @review.StateEnum.ToString()
                        </MudChip>
                    </MudStack>
                    @if (review.Rating.HasValue)
                    {
                        <MudRating SelectedValue="@review.Rating.Value" ReadOnly="true" Size="Size.Small" />
                    }
                </MudStack>
                @if (!string.IsNullOrEmpty(review.ReviewText))
                {
                    <MudText Typo="Typo.body2" Style="color: #b0b0b0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">
                        @review.ReviewText
                    </MudText>
                }
                <MudStack Row="true" Spacing="1">
                    <MudText Typo="Typo.caption" Style="color: #808080;">
                        @review.UpdatedAt.ToString("MMM dd, yyyy", CultureInfo.InvariantCulture)
                    </MudText>
                </MudStack>
            </MudStack>
        </MudPaper>
    }
    </MudStack>

</MudPaper>
}
else
{
    <MudText Typo="Typo.body2" Align="Align.Center" Style="color: #808080; padding: 40px 0;">
        No reviews yet. Start reviewing games!
    </MudText>
}

@code{
    [Parameter] public List<DetailReviewDto> Reviews { get; set; } = new();
    [Parameter] public List<BasicReviewDto> BasicReviews { get; set; } = new();
}