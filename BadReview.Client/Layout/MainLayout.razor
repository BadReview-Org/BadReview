@using System.Threading.Tasks
@inherits LayoutComponentBase
@* Required *@
<MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="_theme"/>
<MudPopoverProvider />

@* Needed for dialogs *@
<MudDialogProvider />

@* Needed for snackbars *@
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar>
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
        <MudSpacer />
        <MudText Typo="Typo.h5" Style="font-family: 'Montserrat', 'Helvetica', sans-serif; font-weight: 700; letter-spacing: 1px;">
            BadReview
        </MudText>
        <MudSpacer />


        <MudMenu Icon="@Icons.Material.Filled.MoreVert" AriaLabel="Open user menu" Dense="true">
            <MudMenuItem Label="Profile"/>
            <MudMenuItem Label="My account" />
            <MudMenuItem Label="Logout" />

            <MudDivider></MudDivider>

            <MudMenuItem OnClick="@((e) => DarkModeToogle())" AutoClose="false">
                <MudSwitch @bind-Value="_isDarkMode" ReadOnly="true" Color="Color.Primary"
                    T="bool" Label="Dark Mode" Size="Size.Medium" LabelPlacement="Placement.Left"
                    ThumbIcon="@(_isDarkMode==true ? Icons.Material.Outlined.DarkMode : Icons.Material.Outlined.WbSunny)"
                    ThumbIconColor="@(_isDarkMode==true ? Color.Info : Color.Error)"/>
            </MudMenuItem>
        </MudMenu>

    </MudAppBar>
    <MudDrawer @bind-Open="@_drawerOpen" Fixed="true" Variant="@DrawerVariant.Mini" OpenMiniOnHover="true">
        <NavMenu/>
    </MudDrawer>
    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.Large">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    private MudTheme _theme = new MudTheme();
    private bool _isDarkMode;
    bool _drawerOpen = true;
    bool disableDarkModeToggle = false;

    async Task DarkModeToogle() {
        if (!disableDarkModeToggle)
        {
            _isDarkMode = !_isDarkMode;
            Console.WriteLine("DarkModeToogle");
            disableDarkModeToggle = true;
            await Task.Delay(500);
            disableDarkModeToggle = false;
        }
    }

    void DrawerToggle() => _drawerOpen = !_drawerOpen;
}