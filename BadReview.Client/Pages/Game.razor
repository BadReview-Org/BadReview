@page "/game/{id:int}"
@using BadReview.Shared.DTOs.Response
@using BadReview.Client.Utils
@inject HttpClient Client
@inject NavigationManager Navigation

<PageTitle>@gameDetails?.Name</PageTitle>

@if (gameDetails == null)
{
    <MudContainer MaxWidth="MaxWidth.Large" Class="mt-6">
        <MudGrid>
            <MudItem xs="12" md="4">
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="600px" />
            </MudItem>
            <MudItem xs="12" md="8">
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100px" Class="mb-4" />
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="200px" Class="mb-4" />
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="400px" />
            </MudItem>
        </MudGrid>
    </MudContainer>
}
else
{
    <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-6">
        <MudGrid Spacing="4">
            <!-- Cover y Info Lateral -->
            <MudItem xs="12" md="4" lg="3">
                <MudStack Spacing="3">
                    <!-- Cover Image -->
                    <MudPaper Elevation="10" Class="pa-3 mud-elevation-hover" Style="background: linear-gradient(145deg, #2a2a2a, #1a1a1a); transition: all 0.3s ease;">
                        <MudImage Src="@ImageHelper.GetCoverUrl(gameDetails.Cover)" 
                                  Alt="@gameDetails.Name" 
                                  Class="rounded-lg" 
                                  Style="width: 100%; height: auto; box-shadow: 0 8px 32px rgba(0,0,0,0.4);" />
                    </MudPaper>
                    <MudPaper Elevation ="6" Class="pa-3" Style="background: linear-gradient(145deg, #2a2a2a, #1a1a1a);">
                        <MudText Typo="Typo.h6" Align="Align.Center" Style="color: #e0e0e0;">
                            Released <br />
                             @(gameDetails.Date.HasValue ? DateTimeOffset.FromUnixTimeSeconds(gameDetails.Date.Value).DateTime.ToString("d 'de' MMMM, yyyy") : "TBA")
                        </MudText>
                    </MudPaper>

                    <!-- Genres -->
                    @if (gameDetails.Genres?.Any() == true)
                    {
                        <MudPaper Class="pa-3" Elevation="6" Style="background: linear-gradient(145deg, #2a2a2a, #1a1a1a);">
                            <MudText Typo="Typo.h6" Class="mb-2">
                                <MudIcon Icon="@Icons.Material.Filled.Category" Size="Size.Small" Class="mr-2" />
                                Genres
                            </MudText>
                            <MudStack Row="true" Spacing="1" Wrap="Wrap.Wrap">
                                @foreach (var genre in gameDetails.Genres)
                                {
                                    <MudChip T="string" Size="Size.Small" Color="Color.Primary" Variant="Variant.Filled">
                                        @genre.Name
                                    </MudChip>
                                }
                            </MudStack>
                        </MudPaper>
                    }

                    <!-- Platforms -->
                    @if (gameDetails.Platforms?.Any() == true)
                    {
                        <MudPaper Class="pa-3" Elevation="6" Style="background: linear-gradient(145deg, #2a2a2a, #1a1a1a);">
                            <MudText Typo="Typo.h6" Class="mb-2">
                                <MudIcon Icon="@Icons.Material.Filled.Devices" Size="Size.Small" Class="mr-2" />
                                Platforms
                            </MudText>
                            <MudStack Row="true" Spacing="1" Wrap="Wrap.Wrap">
                                @foreach (var platform in gameDetails.Platforms)
                                {
                                    <MudChip T="string" Size="Size.Small" Color="Color.Secondary" Variant="Variant.Filled">
                                        @platform.Name
                                    </MudChip>
                                }
                            </MudStack>
                        </MudPaper>
                    }

                    <!-- Developers -->
                    @if (gameDetails.Developers?.Any() == true)
                    {
                        <MudPaper Class="pa-3" Elevation="6" Style="background: linear-gradient(145deg, #2a2a2a, #1a1a1a);">
                            <MudText Typo="Typo.h6" Class="mb-2">
                                <MudIcon Icon="@Icons.Material.Filled.Code" Size="Size.Small" Class="mr-2" />
                                Developers
                            </MudText>
                            @foreach (var developer in gameDetails.Developers)
                            {
                                <MudText Typo="Typo.body2" Color="Color.Default">
                                    @developer.Name
                                </MudText>
                            }
                        </MudPaper>
                    }
                </MudStack>
            </MudItem>
            
            <!-- Contenido Principal -->
            <MudItem xs="12" md="8" lg="9">
                <MudStack Spacing="4">
                    <!-- TÃ­tulo con Gradient -->
                    <MudPaper Class="pa-4" Elevation="8" Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px;">
                        <MudText Typo="Typo.h2" Style="font-weight: 700; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                            @gameDetails.Name
                        </MudText>
                    </MudPaper>

                    <!-- Description -->
                    <MudPaper Class="pa-4" Elevation="6" Style="background: linear-gradient(145deg, #2a2a2a, #1a1a1a);">
                        <MudText Typo="Typo.h5" Class="mb-3" Style="color: #667eea;">
                            <MudIcon Icon="@Icons.Material.Filled.Description" Size="Size.Medium" Class="mr-2" />
                            About This Game
                        </MudText>
                        <MudText Typo="Typo.body1" Style="line-height: 1.8; color: #e0e0e0;">
                            @gameDetails.Summary
                        </MudText>
                    </MudPaper>

                    <!-- Video Trailer -->
                    @if (!string.IsNullOrEmpty(gameDetails.Video))
                    {
                        <MudPaper Class="pa-4" Elevation="8" Style="background: linear-gradient(145deg, #2a2a2a, #1a1a1a);">
                            <MudText Typo="Typo.h5" Class="mb-3" Style="color: #764ba2;">
                                <MudIcon Icon="@Icons.Material.Filled.PlayCircle" Size="Size.Medium" Class="mr-2" />
                                Game Trailer
                            </MudText>
                            <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.4);">
                                <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                                        src="https://www.youtube.com/embed/@(gameDetails.Video)?autoplay=0&mute=0"
                                        title="YouTube video player"
                                        frameborder="0"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        allowfullscreen>
                                </iframe>
                            </div>
                        </MudPaper>
                    }
                </MudStack>
            </MudItem>
        </MudGrid>
    </MudContainer>
}


@code {
    [Parameter]
    public int id { get; set; }
    private DetailGameDto? gameDetails;
    protected override async Task OnInitializedAsync()
    {
        gameDetails = await Client.GetFromJsonAsync<DetailGameDto>($"api/games/{id}");
        if (gameDetails == null)
        {
            Navigation.NavigateTo("/trending-games");
        }
    }
}
