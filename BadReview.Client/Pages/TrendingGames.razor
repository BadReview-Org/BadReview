@page "/trending-games"
@using BadReview.Shared.DTOs.Response
@using BadReview.Client.Utils
@using BadReview.Client.Services
@using BadReview.Shared.Utils
@inject HttpClient Client
@inject NavigationManager Navigation
@inject ApiService ApiService

<PageTitle>Trending Games</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <!-- Header con Gradient -->
    <MudPaper Class="pa-4 mb-6" Elevation="8" Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px;">
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
            <MudIcon Icon="@Icons.Material.Filled.Whatshot" Size="Size.Large" Style="color: white;" />
            <MudText Typo="Typo.h3" Style="font-weight: 700; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                Trending Games
            </MudText>
        </MudStack>
        <MudText Typo="Typo.body1" Class="mt-2" Style="color: rgba(255,255,255,0.9);">
            Discover the hottest games right now
        </MudText>
    </MudPaper>
    <CustomGridCard totalPages="@totalPages" PageChanged="@OnPageChanged" arrayElement="gameCards" placeholderTitle="No games found." placeholderBody="Check back later for trending games!"/>
</MudContainer>


@code {
    private CardContainer[]? gameCards;
    private int totalPages;
    
    protected override async Task OnInitializedAsync()
    {
        ApiRequest apiRequest = new ApiRequest{URI = APIUTILS.URIS.TRENDING, Page = 0 };
        PagedResult<BasicGameDto>? gamesDto = await ApiService.GetManyAsync<BasicGameDto>(apiRequest);
        totalPages = (gamesDto?.TotalCount ?? 0 )/ (gamesDto?.PageSize ?? 1);
        gameCards = gamesDto?.Data.Select(g => new CardContainer(new BasicGameCardStrat(), g)).ToArray();
    }

    private async Task OnPageChanged(int page)
    {
        gameCards = null;      // Mostrar skeleton mientras se carga la nueva p√°gina

        ApiRequest apiRequest = new ApiRequest{URI = APIUTILS.URIS.TRENDING, Page = page-1 };
        PagedResult<BasicGameDto>? gamesDto = await ApiService.GetManyAsync<BasicGameDto>(apiRequest);
        gameCards = gamesDto?.Data.Select(g => new CardContainer(new BasicGameCardStrat(), g)).ToArray();
    }

}
